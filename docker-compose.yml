services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    image: hochzeit-app:latest
    ports:
      - "${APP_PORT:-8010}:80"
    environment:
      APP_URL: "${APP_URL:-http://localhost:8010}"

      DB_HOST: "${DB_HOST:-127.0.0.1}"
      DB_NAME: "${DB_NAME:-wedding_app}"
      DB_USER: "${DB_USER:-root}"
      DB_PASS: "${DB_PASS:-}"

      # Only used when the users table is empty.
      ADMIN_INITIAL_USERNAME: "${ADMIN_INITIAL_USERNAME:-admin}"
      ADMIN_INITIAL_PASSWORD: "${ADMIN_INITIAL_PASSWORD:-}"

      # Optional Synology integration
      SYNO_BASE_URL: "${SYNO_BASE_URL:-}"
      SYNO_USERNAME: "${SYNO_USERNAME:-}"
      SYNO_PASSWORD: "${SYNO_PASSWORD:-}"
      SYNO_TARGET_PATH: "${SYNO_TARGET_PATH:-/wedding-uploads}"
      SYNO_VERIFY_SSL: "${SYNO_VERIFY_SSL:-1}"

      # Optional fallback for master key
      GALLERY_MASTER_KEY: "${GALLERY_MASTER_KEY:-}"
    volumes:
      - "${UPLOADS_PATH:-hochzeit_uploads}:/var/www/html/uploads"
      - "${QRCODES_PATH:-hochzeit_qrcodes}:/var/www/html/qrcodes"
    restart: unless-stopped

volumes:
  hochzeit_uploads:
  hochzeit_qrcodes:
